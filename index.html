<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#FDFBF7">
    <title>æ±äº¬æ—…è¨˜ Tokyo Trip Pro</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Shippori+Mincho:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
        :root {
            --bg-color: #FDFBF7;
            --card-bg: #FFFFFF;
            --text-primary: #4A4036;
            --text-secondary: #8C837B;
            --accent: #C7B398;
            --highlight: #D4A373;
            --nav-active: #8D7B68;
            --shadow: 0 4px 12px rgba(74, 64, 54, 0.08);
            --radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0; padding-bottom: 90px;
        }

        header {
            position: sticky; top: 0; background: rgba(253, 251, 247, 0.95);
            backdrop-filter: blur(10px); padding: 15px 20px; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.03);
            padding-top: max(15px, env(safe-area-inset-top));
        }
        .app-title { font-family: 'Shippori Mincho', serif; font-size: 1.4rem; font-weight: 600; }

        .add-btn {
            background: var(--highlight); color: white; border: none;
            width: 32px; height: 32px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: var(--shadow);
        }

        .tabs-wrapper { overflow-x: auto; white-space: nowrap; padding: 10px 20px; scrollbar-width: none; }
        .tabs-wrapper::-webkit-scrollbar { display: none; }
        .tab-item {
            display: inline-block; padding: 8px 18px; margin-right: 10px;
            border-radius: 20px; font-size: 0.9rem; color: var(--text-secondary);
            background: #F2EFE9; transition: all 0.3s; cursor: pointer;
        }
        .tab-item.active { background: var(--nav-active); color: #fff; box-shadow: var(--shadow); }

        .section-container { padding: 0 20px; animation: fadeIn 0.4s ease; }
        
        .weather-card {
            background: linear-gradient(135deg, #FFFDF9 0%, #F5F1E8 100%);
            border-radius: var(--radius); padding: 15px; margin-bottom: 15px;
            box-shadow: var(--shadow); display: flex; flex-direction: column; gap: 10px;
        }
        .weather-info { display: flex; align-items: center; gap: 15px; }
        .temp-display { font-size: 1.8rem; font-family: 'Shippori Mincho'; font-weight: 600; }
        .outfit-box { background: rgba(255,255,255,0.6); padding: 10px; border-radius: 8px; font-size: 0.85rem; border: 1px solid #EEE; }

        .hotel-card {
            background: #FFFFFF; border-left: 4px solid var(--accent);
            border-radius: 8px; padding: 12px 16px; margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03); font-size: 0.9rem;
        }

        .sortable-ghost { opacity: 0.3; background: var(--accent) !important; }
        .sortable-chosen { box-shadow: 0 8px 20px rgba(0,0,0,0.15) !important; }

        .timeline-item {
            background: var(--card-bg); border-radius: var(--radius); margin-bottom: 12px;
            display: flex; box-shadow: var(--shadow); position: relative;
        }
        .map-trigger {
            width: 50px; background: #F4F1EC; display: flex; flex-direction: column;
            align-items: center; justify-content: center; font-size: 0.7rem; color: var(--highlight);
            border-radius: var(--radius) 0 0 var(--radius); cursor: pointer;
        }
        .item-content { flex: 1; padding: 12px; }
        .item-time { font-size: 0.8rem; font-weight: 700; color: var(--text-secondary); display: inline-block; margin-bottom: 4px; }
        .item-title { font-size: 1rem; font-weight: 600; margin: 2px 0; }
        .tag { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; background: #eee; }
        .tag.food { background: #FFECB3; } .tag.transport { background: #E1F5FE; } .tag.shop { background: #F8BBD0; }
        .item-weather { font-size: 0.75rem; color: #5B9BD5; margin-left: 8px; }

        /* å¸³æœ¬æ¨£å¼ */
        .ledger-input-group { background: #FFF; padding: 15px; border-radius: var(--radius); margin-bottom: 20px; box-shadow: var(--shadow); }
        .ledger-input-group input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #EEE; border-radius: 8px; }
        .ledger-item { background: #FFF; padding: 12px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .total-banner { background: var(--nav-active); color: white; padding: 20px; border-radius: var(--radius); text-align: center; margin-top: 20px; }

        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; background: #FFF;
            display: flex; justify-content: space-around; padding: 10px 0;
            padding-bottom: max(10px, env(safe-area-inset-bottom)); border-top: 1px solid #EEE; z-index: 100;
        }
        .nav-btn { border: none; background: none; color: #BBB; font-size: 0.7rem; text-align: center; cursor: pointer; }
        .nav-btn.active { color: var(--nav-active); }
        .nav-btn i { font-size: 1.2rem; display: block; margin-bottom: 4px; }

        /* æ”»ç•¥åˆ—è¡¨å„ªåŒ– */
        .guide-section { margin-bottom: 25px; }
        .guide-title { font-weight: 700; color: var(--highlight); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .guide-card { background: #FFF; padding: 15px; border-radius: 12px; box-shadow: var(--shadow); }
        .guide-card ul { margin: 0; padding-left: 18px; color: var(--text-primary); font-size: 0.9rem; line-height: 1.8; }
        .guide-card li { margin-bottom: 5px; }

        [contenteditable="true"]:focus { background: #fffdf0; outline: none; border-radius: 4px; }
        @keyframes fadeIn { from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);} }
    </style>
</head>
<body>

    <div id="page-itinerary">
        <header>
            <div class="app-title">æ±äº¬æ—…è¨˜ <span style="font-size:0.8rem; color:#888;">Dec 25-31</span></div>
            <button class="add-btn" onclick="addItem()"><i class="fas fa-plus"></i></button>
        </header>
        <div class="tabs-wrapper" id="day-tabs"></div>
        <div id="day-content" class="section-container"></div>
    </div>

    <div id="page-notices" style="display:none;">
        <header><div class="app-title">æ—…è¡Œå¿…çœ‹æ”»ç•¥</div></header>
        <div class="section-container" style="padding-top:20px;">
            
            <div class="guide-section">
                <div class="guide-title"><i class="fas fa-plane-arrival"></i> å…¥å¢ƒèˆ‡ç¶²è·¯</div>
                <div class="guide-card">
                    <ul>
                        <li>è¨˜å¾—å…ˆå¡«å¯« <b>Visit Japan Web</b> ä¸¦æˆªåœ– QR Codeã€‚</li>
                        <li>æº–å‚™å¯¦é«”è¥¿ç“œå¡æˆ–æ‰‹æ©Ÿ Apple Wallet ç¶å®š Suica/Pasmoã€‚</li>
                        <li>äº‹å…ˆä¸‹è¼‰ Google Maps é›¢ç·šåœ°åœ–å‚™ç”¨ã€‚</li>
                    </ul>
                </div>
            </div>

            <div class="guide-section">
                <div class="guide-title"><i class="fas fa-shopping-bag"></i> è³¼ç‰©èˆ‡å…ç¨…</div>
                <div class="guide-card">
                    <ul>
                        <li>éš¨èº«æ”œå¸¶<b>è­·ç…§æ­£æœ¬</b>ï¼Œå–®åº—æ»¿ 5,000 æ—¥åœ“å¯é€€ç¨…ã€‚</li>
                        <li>å…ç¨…å“åœ¨æ—¥æœ¬ä¸å¯æ‹†å°ï¼ˆæ¨™è¨»æ¶ˆè€—å“é¡è€…ï¼‰ã€‚</li>
                        <li><b>å¿…é€›æ¨è–¦ï¼š</b>3COINS, éŠ€åº§ä¸‰è¶Š B2 è²»å—é›ª, Loftã€‚</li>
                    </ul>
                </div>
            </div>

            <div class="guide-section">
                <div class="guide-title"><i class="fas fa-heart"></i> æ—¥æœ¬ç¦®å„€</div>
                <div class="guide-card">
                    <ul>
                        <li>è¡—é“å¾ˆå°‘åƒåœ¾æ¡¶ï¼Œå»ºè­°éš¨èº«å¸¶å€‹å°å¡‘è† è¢‹è£åƒåœ¾ã€‚</li>
                        <li>æ­ä¹˜åœ°éµæ™‚è«‹ä¿æŒå®‰éœï¼Œæ‰‹æ©Ÿèª¿è‡³éœéŸ³æ¨¡å¼ï¼Œä¸æ’¥æ‰“é›»è©±ã€‚</li>
                        <li>çµå¸³æ™‚å°‡éŒ¢æ”¾åœ¨å°ˆç”¨å°æ‰˜ç›¤ä¸Šï¼Œä¸è¦ç›´æ¥éçµ¦åº—å“¡ã€‚</li>
                    </ul>
                </div>
            </div>

            <div class="guide-section">
                <div class="guide-title"><i class="fas fa-mountain"></i> å¯Œå£«å±±æ”»ç•¥</div>
                <div class="guide-card">
                    <ul>
                        <li>æ²³å£æ¹–æ¸…æ™¨æ¥µå†·ï¼ˆå¯é” 0Â°C ä»¥ä¸‹ï¼‰ï¼Œå‹™å¿…æ´‹è”¥å¼ç©¿æ³•ã€‚</li>
                        <li><b>å¯Œå£«å›éŠåˆ—è»Š</b>å¼·çƒˆå»ºè­°ææ—©ä¸€å€‹æœˆé ç´„ã€‚</li>
                        <li>ä¾¿åˆ©å•†åº—ï¼ˆLawsonï¼‰æ‹ç…§è«‹æ³¨æ„å®‰å…¨èˆ‡ç•¶åœ°è¦ç¯„ï¼Œå‹¿é˜»ç¤™äº¤é€šã€‚</li>
                    </ul>
                </div>
            </div>

        </div>
    </div>

    <div id="page-ledger" style="display:none;">
        <header><div class="app-title">æ—…éŠå¸³æœ¬</div></header>
        <div class="section-container" style="padding-top:20px;">
            <div class="ledger-input-group">
                <input type="text" id="expense-name" placeholder="é …ç›®åç¨± (å¦‚ï¼šåˆé¤)">
                <input type="number" id="expense-jpy" placeholder="æ—¥å¹£é‡‘é¡ (JPY)">
                <button onclick="addLedgerItem()" style="width:100%; padding:10px; background:var(--highlight); color:white; border:none; border-radius:8px; margin-top:10px;">è¨˜éŒ„æ”¯å‡º</button>
            </div>
            
            <div id="ledger-list"></div>

            <div class="total-banner">
                <div style="font-size:0.9rem; opacity:0.9;">ç¸½é ç®— (å°å¹£) åŒ¯ç‡ 0.215</div>
                <div id="total-twd" style="font-size:1.8rem; font-weight:700; margin:10px 0;">NT$ 0</div>
                <div id="split-result" style="font-size:1rem; border-top:1px solid rgba(255,255,255,0.3); padding-top:10px;">
                    4 äººåˆ†å¸³ï¼šæ¯äºº NT$ 0
                </div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-btn active" onclick="switchPage('itinerary')"><i class="fas fa-calendar-alt"></i> è¡Œç¨‹</button>
        <button class="nav-btn" onclick="switchPage('ledger')"><i class="fas fa-wallet"></i> å¸³æœ¬</button>
        <button class="nav-btn" onclick="switchPage('notices')"><i class="fas fa-info-circle"></i> æ”»ç•¥</button>
    </nav>

    <script>
        const JPY_RATE = 0.215; 
        const tripData = {
            day1: {
                date: "12/25 (ä¸‰)",
                weather: { temp: "8Â°C", icon: "â˜ï¸", desc: "å†·æ¶¼é™°å¤©", outfit: "ç™¼ç†±è¡£+æ¯›è¡£+é˜²é¢¨å¤§è¡£ã€‚æ¡æ´‹è”¥å¼ç©¿æ³•ã€‚" },
                hotel: "ğŸ  ä½å®¿: 3 Chome-4-1 Narihira (æŠ¼ä¸Šç«™)",
                note: "æŠµé”æ—¥é‡é»ï¼šSkyliner é ˜ç¥¨èˆ‡é’ç ¥ç«™è½‰ä¹˜ã€‚",
                items: [
                    { time: '18:30', title: 'æŠµé”æˆç”°æ©Ÿå ´ (NRT)', type: 'transport', addr: 'Narita Airport', desc: 'å…¥å¢ƒå¯©æŸ¥èˆ‡é ˜å– Skyliner è»Šç¥¨ã€‚', subWeather: 'â˜ï¸ 8Â°C' },
                    { time: '19:30', title: 'æ­ä¹˜äº¬æˆ Skyliner', type: 'transport', addr: 'Narita Airport Station', desc: 'å¾€äº¬æˆä¸Šé‡æ–¹å‘ï¼Œé’ç ¥ç«™ä¸‹è»Šã€‚', subWeather: 'â˜ï¸ 7Â°C' },
                    { time: '21:30', title: 'æ™šé¤ï¼šå…­å˜èˆ', type: 'food', addr: 'æ™´ç©ºå¡” Solamachi 6F', desc: 'æ²¾éºµååº—ï¼ŒL.O. 22:30ã€‚', subWeather: 'ğŸŒ™ 6Â°C' }
                ]
            },
            day2: {
                date: "12/26 (å››)",
                weather: { temp: "6Â°C", icon: "â˜€ï¸", desc: "æ™´æœ—ä½æº«", outfit: "è¿ªå£«å°¼é æµ·é¢¨å¤§ï¼Œå»ºè­°ä½©æˆ´åœå·¾ã€æš–æš–åŒ…ã€‚" },
                hotel: "ğŸ  ä½å®¿: 3 Chome-4-1 Narihira",
                note: "è¿ªå£«å°¼å…¨æ—¥æ”»ç•¥ï¼šå…¥åœ’å…ˆæ¶ DPA èˆ‡é ç´„ç­‰å€™å¡ã€‚",
                items: [
                    { time: '09:00', title: 'æ±äº¬è¿ªå£«å°¼æ¨‚åœ’å…¥åœ’', type: 'spot', addr: 'Tokyo Disneyland', desc: 'ç¬¬ä¸€è¦å‹™ï¼šè³¼è²·ã€Œç¾å¥³èˆ‡é‡ç¸ã€DPAã€‚', subWeather: 'â˜€ï¸ 5Â°C' },
                    { time: '21:00', title: 'å¤œé–“ç…™ç« / éŠè¡Œ', type: 'spot', addr: 'Tokyo Disneyland', desc: 'å¤¢ä¹‹å…‰é›»å­å¤§éŠè¡Œèˆ‡ç…™ç«ç§€ã€‚', subWeather: 'ğŸŒ™ 3Â°C' }
                ]
            },
            day3: {
                date: "12/27 (äº”)",
                weather: { temp: "9Â°C", icon: "ğŸŒ¤ï¸", desc: "èˆ’é©å¤šé›²", outfit: "å’Œæœé«”é©—æ—¥ï¼Œå…§ç©¿è–„ç™¼ç†±è¡£ï¼ˆVé ˜ï¼‰ã€‚" },
                hotel: "ğŸ  ä½å®¿: 3 Chome-4-1 Narihira",
                note: "éŠ€åº§è³¼ç‰©ç·šï¼šLoft -> MUJI -> Uniqloã€‚",
                items: [
                    { time: '10:00', title: 'æ·ºè‰æ„›å’Œæœé«”é©—', type: 'spot', addr: 'æ·ºè‰æ„›å’Œæœ3è™Ÿåº—', desc: 'æ›è£å¾Œé›·é–€ã€ä»²è¦‹ä¸–é€šè§€å…‰ã€‚', subWeather: 'ğŸŒ¤ï¸ 8Â°C' },
                    { time: '13:00', title: 'åˆé¤ï¼šæ·ºè‰ä»ŠåŠ', type: 'food', addr: 'Asakusa Imahan', desc: 'å£½å–œç‡’ç™¾å¹´è€åº—ï¼ˆå·²é ç´„ï¼‰ã€‚', subWeather: 'ğŸŒ¤ï¸ 10Â°C' },
                    { time: '16:00', title: 'éŠ€åº§è³¼ç‰©è¡Œç¨‹', type: 'shop', addr: 'Ginza Loft', desc: 'å« Loftã€MUJI æ——è‰¦åº—ç­‰ã€‚', subWeather: 'ğŸŒ¤ï¸ 9Â°C' }
                ]
            },
            day4: {
                date: "12/28 (å…­)",
                weather: { temp: "2Â°C", icon: "ğŸ—»", desc: "æ²³å£æ¹–å¯’å†·", outfit: "å±±å€æ¥µå¯’ï¼Œé ˆç©¿è‘—åšç¾½çµ¨è¡£ã€æ‰‹å¥—ã€‚" },
                hotel: "ğŸ  ä½å®¿: æ·ºå· 180-1 (æ²³å£æ¹–)",
                note: "æ²³å£æ¹–ç§»å‹•æ—¥ï¼šå¤§è¡Œæå¯„æ”¾æ–°å®¿ç«™ã€‚",
                items: [
                    { time: '10:00', title: 'æ–°å®¿å·´å£«ç«™å‡ºç™¼', type: 'transport', addr: 'Shinjuku Bus Terminal', desc: 'å‰å¾€æ²³å£æ¹–ï¼Œè»Šç¨‹ç´„ 2 å°æ™‚ã€‚', subWeather: 'â˜€ï¸ 5Â°C' },
                    { time: '15:30', title: 'å¤§çŸ³å…¬åœ’ (ç´…ç·šå·´å£«)', type: 'spot', addr: 'Oishi Park', desc: 'æ‹æ”å¯Œå£«å±±çµ•æ™¯ã€‚', subWeather: 'â˜€ï¸ 1Â°C' }
                ]
            },
            day5: {
                date: "12/29 (æ—¥)",
                weather: { temp: "3Â°C", icon: "â˜€ï¸", desc: "å±±å€æ™´æœ—", outfit: "ä¿æš–ç¾½çµ¨è¡£ã€é˜²æ»‘é‹ã€‚æ—©æ™šæº«å·®æ¥µå¤§ã€‚" },
                hotel: "ğŸ  ä½å®¿: æ±Ÿæˆ¶å·å€æ¾å³¶ (æ–°å°å²©)",
                note: "æ–°å€‰å¯Œå£«æ·ºé–“ç¥ç¤¾é ˆçˆ¬éšæ¢¯ï¼Œå»ºè­°ç©¿å¥½èµ°çš„é‹ã€‚",
                items: [
                    { time: '09:25', title: 'æ–°å€‰å¯Œå£«æ·ºé–“ç¥ç¤¾', type: 'spot', addr: 'Chureito Pagoda', desc: 'ç¶“å…¸äº”é‡å¡”+å¯Œå£«å±±æ‹æ”é»ã€‚', subWeather: 'â˜€ï¸ -1Â°C' },
                    { time: '18:30', title: 'æ™šé¤ï¼šæ–°å®¿ç‡’è‚‰ Bondz', type: 'food', addr: 'æ–°å®¿', desc: 'è¿”å›æ–°å®¿å¾Œäº«ç”¨ç‡’è‚‰ã€‚', subWeather: 'ğŸŒ™ 2Â°C' }
                ]
            },
            day6: {
                date: "12/30 (ä¸€)",
                weather: { temp: "8Â°C", icon: "ğŸ›ï¸", desc: "å¸‚å€å†·", outfit: "ç©¿è‘—èˆ’é©çš„æ­¥è¡Œé‹ï¼Œé€™å¤©è¡Œç¨‹è³¼ç‰©è¼ƒå¤šã€‚" },
                hotel: "ğŸ  ä½å®¿: æ–°å°å²© (é€£ä½)",
                note: "æœ€å¾Œæƒè²¨ï¼šä¸Šé‡äºŒæœ¨ä¹‹è“å­ã€æ¾€è°· Sky å¤œæ™¯ã€‚",
                items: [
                    { time: '10:00', title: 'ä¸Šé‡é˜¿ç¾æ©«ä¸', type: 'shop', addr: 'äºŒæœ¨ä¹‹è“å­', desc: 'è³¼è²·ä¼´æ‰‹ç¦®ã€è—¥å¦ã€‚', subWeather: 'ğŸŒ¤ï¸ 7Â°C' },
                    { time: '14:00', title: 'Shibuya Sky æ¾€è°·å¤©ç©º', type: 'spot', addr: 'æ¾€è°·', desc: 'ä¿¯ç°æ±äº¬å¤œæ™¯ã€‚', subWeather: 'ğŸŒ¤ï¸ 6Â°C' }
                ]
            },
            day7: {
                date: "12/31 (äºŒ)",
                weather: { temp: "7Â°C", icon: "âœˆï¸", desc: "æ™´è½‰å¤šé›²", outfit: "ç©¿è‘—æœ€åšå¯¦çš„è¡£ç‰©ä¸Šæ©Ÿã€‚" },
                hotel: "ğŸ  è¿”å›æº«æš–çš„å®¶",
                note: "æ©Ÿå ´å…ç¨…åº—æœ€å¾Œè¡åˆºï¼šè²· Financier Henri Charpentierã€‚",
                items: [
                    { time: '14:30', title: 'å‰å¾€æ©Ÿå ´', type: 'transport', addr: 'NRT', desc: 'ææ—©æŠµé”é€›å…ç¨…åº—ã€‚', subWeather: 'ğŸŒ¤ï¸ 7Â°C' },
                    { time: '19:30', title: 'ç­æ¬¡ CI109 èµ·é£›', type: 'transport', addr: 'Narita Airport', desc: 'çµæŸç¾å¥½æ—…ç¨‹ã€‚', subWeather: 'ğŸŒ™ 5Â°C' }
                ]
            }
        };

        let currentDay = 'day1';
        let ledgerData = [];

        function init() {
            renderTabs();
            renderDay(currentDay);
        }

        function renderTabs() {
            const container = document.getElementById('day-tabs');
            container.innerHTML = Object.keys(tripData).map(key => `
                <div class="tab-item ${key === currentDay ? 'active' : ''}" onclick="selectDay('${key}')">
                    ${tripData[key].date}
                </div>
            `).join('');
        }

        function selectDay(key) {
            currentDay = key;
            renderTabs();
            renderDay(key);
        }

        function renderDay(dayKey) {
            const data = tripData[dayKey];
            const container = document.getElementById('day-content');
            
            container.innerHTML = `
                <div class="weather-card">
                    <div class="weather-info">
                        <span class="temp-display">${data.weather.temp}</span>
                        <span>${data.weather.icon} ${data.weather.desc}</span>
                    </div>
                    <div class="outfit-box"><b>ğŸ‘— ç©¿æ­å»ºè­°ï¼š</b>${data.weather.outfit}</div>
                </div>
                <div class="hotel-card" contenteditable="true">${data.hotel}</div>
                <div id="sortable-list">
                    ${data.items.map((item, index) => `
                        <div class="timeline-item" data-id="${index}">
                            <div class="map-trigger" onclick="window.open('https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent('${item.addr}'))">
                                <i class="fas fa-map-marker-alt"></i> å°èˆª
                            </div>
                            <div class="item-content">
                                <span class="item-time" contenteditable="true">${item.time}</span>
                                <span class="item-weather">${item.subWeather || ''}</span>
                                <div class="item-title" contenteditable="true">${item.title}</div>
                                <span class="tag ${item.type}">${item.type === 'food' ? 'ç¾é£Ÿ' : (item.type === 'shop' ? 'è³¼ç‰©' : 'æ™¯é»')}</span>
                                <p style="font-size:0.8rem; color:#888; margin:5px 0 0 0;" contenteditable="true">${item.desc}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="notes-area"><b>ğŸ“ å‚™è¨»ï¼š</b><span contenteditable="true">${data.note}</span></div>
            `;

            const el = document.getElementById('sortable-list');
            new Sortable(el, {
                animation: 150,
                delay: 200, 
                delayOnTouchOnly: true,
                ghostClass: 'sortable-ghost',
                onEnd: function (evt) {
                    const movedItem = tripData[dayKey].items.splice(evt.oldIndex, 1)[0];
                    tripData[dayKey].items.splice(evt.newIndex, 0, movedItem);
                }
            });
        }

        function addItem() {
            tripData[currentDay].items.push({
                time: '00:00',
                title: 'æ–°è¡Œç¨‹',
                type: 'spot',
                addr: '',
                desc: 'é»æ“Šæ­¤è™•ç·¨è¼¯å…§å®¹',
                subWeather: 'â˜€ï¸ --Â°C'
            });
            renderDay(currentDay);
        }

        function addLedgerItem() {
            const nameInput = document.getElementById('expense-name');
            const jpyInput = document.getElementById('expense-jpy');
            
            if (nameInput.value && jpyInput.value) {
                const item = {
                    name: nameInput.value,
                    jpy: parseFloat(jpyInput.value),
                    twd: Math.round(parseFloat(jpyInput.value) * JPY_RATE)
                };
                ledgerData.push(item);
                nameInput.value = '';
                jpyInput.value = '';
                renderLedger();
            }
        }

        function renderLedger() {
            const container = document.getElementById('ledger-list');
            let totalTwd = 0;
            container.innerHTML = ledgerData.map((item) => {
                totalTwd += item.twd;
                return `
                    <div class="ledger-item">
                        <span>${item.name}</span>
                        <span style="color:var(--text-secondary);">Â¥${item.jpy} â†’ <b>NT$ ${item.twd}</b></span>
                    </div>
                `;
            }).join('');
            document.getElementById('total-twd').innerText = `NT$ ${totalTwd.toLocaleString()}`;
            document.getElementById('split-result').innerText = `4 äººåˆ†å¸³ï¼šæ¯äºº NT$ ${Math.round(totalTwd / 4).toLocaleString()}`;
        }

        function switchPage(page) {
            document.getElementById('page-itinerary').style.display = page === 'itinerary' ? 'block' : 'none';
            document.getElementById('page-notices').style.display = page === 'notices' ? 'block' : 'none';
            document.getElementById('page-ledger').style.display = page === 'ledger' ? 'block' : 'none';
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.toggle('active', btn.innerText.includes(
                    page === 'itinerary' ? 'è¡Œç¨‹' : (page === 'ledger' ? 'å¸³æœ¬' : 'æ”»ç•¥')
                ));
            });
        }

        init();
    </script>
</body>
</html>
